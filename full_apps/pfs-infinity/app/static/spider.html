<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>pfs-infinity â€” Spider</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; margin: 2rem; }
      .row { display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem; }
      #log { white-space: pre-wrap; background: #111; color: #ddd; padding: 1rem; border-radius: 8px; min-height: 8rem; }
      label { width: 11rem; display: inline-block; }
      input[type=text] { width: 30rem; }
    </style>
  </head>
  <body>
    <h1>Spider</h1>
    <div class="row">
      <label>Coordinator URL:</label>
      <input id="coord" type="text" placeholder="http://127.0.0.1:8811" value="http://127.0.0.1:8811" />
    </div>
    <div class="row">
      <label>Seeds (one per line):</label>
      <textarea id="seeds" rows="6" cols="60" placeholder="https://example.com
https://example.org"></textarea>
    </div>
    <div class="row">
      <button id="start">Create Plan</button>
      <button id="lease">Get Lease</button>
    </div>
    <h3>Log</h3>
    <div id="log"></div>

    <script type="module">
      const logEl = document.getElementById('log')
      const coordEl = document.getElementById('coord')
      const seedsEl = document.getElementById('seeds')
      const startBtn = document.getElementById('start')
      const leaseBtn = document.getElementById('lease')

      function log(msg) {
        logEl.textContent += msg + '\n'
        logEl.scrollTop = logEl.scrollHeight
      }

      startBtn.addEventListener('click', async () => {
        try {
          const coord = coordEl.value.trim() || 'http://127.0.0.1:8811'
          const seeds = seedsEl.value.split(/\n+/).map(s => s.trim()).filter(Boolean)
          const body = { plan_version: '1.0.0', seeds }
          log('[POST] ' + coord + '/spider/plans ' + JSON.stringify(body))
          const r = await fetch(coord + '/spider/plans', { method: 'POST', headers: { 'content-type': 'application/json' }, body: JSON.stringify(body) })
          const j = await r.json()
          log('[plan] ' + JSON.stringify(j))
        } catch (e) {
          log('[error] ' + e)
        }
      })

      leaseBtn.addEventListener('click', async () => {
        try {
          const coord = coordEl.value.trim() || 'http://127.0.0.1:8811'
          const u = new URL('/spider/lease', coord)
          u.searchParams.set('worker_id', 'ui')
          u.searchParams.set('n', '5')
          const r = await fetch(u, { method: 'GET' })
          const j = await r.json()
          log('[lease] ' + JSON.stringify(j))
        } catch (e) {
          log('[error] ' + e)
        }
      })
    </script>
  </body>
</html>
