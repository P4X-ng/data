<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>F3 Infinite Storage â€” Spider</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; margin: 2rem; }
      .row { display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem; }
      #log { white-space: pre-wrap; background: #111; color: #ddd; padding: 1rem; border-radius: 8px; min-height: 8rem; }
      label { width: 11rem; display: inline-block; }
      input[type=text] { width: 30rem; }
    /* Brand bar */
    .brand-bar { display: flex; align-items: center; gap: 0.75rem; border-bottom: 1px solid #ccc; padding-bottom: .5rem; margin-bottom: 1rem; }
    .brand-bar .logo { height: 40px; width: auto; }
    .brand-bar .brand-title { font-size: 22px; font-weight: 700; margin: 0; }
    .brand-bar .brand-sub { font-size: 12px; opacity: 0.8; margin: 0; }
    .brand-bar nav a { margin-right: .75rem; text-decoration: none; color: #0366d6; }
    .brand-bar nav a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <header class="brand-bar">
      <img src="/static/f3_logo.png" alt="F3 Infinite Storage" class="logo" />
      <div>
        <div class="brand-title">F3 Infinite Storage</div>
        <div class="brand-sub">PacketFS control</div>
      </div>
      <nav style="margin-left:auto;">
        <a href="/static/index.html">Home</a>
        <a href="/static/browse.html">Browse</a>
        <a href="/static/transfer.html">Transfer</a>
        <a href="/static/twin.html">Twin</a>
        <a href="/static/spider.html">Spider</a>
      </nav>
    </header>
    <h1>Spider</h1>
    <div class="row">
      <label>Coordinator URL:</label>
      <input id="coord" type="text" placeholder="https://127.0.0.1:8811" value="https://127.0.0.1:8811" />
    </div>
    <div class="row">
      <label>Seeds (one per line):</label>
      <textarea id="seeds" rows="6" cols="60" placeholder="https://example.com
https://example.org"></textarea>
    </div>
    <div class="row">
      <button id="start">Create Plan</button>
      <button id="lease">Get Lease</button>
    </div>
    <h3>Log</h3>
    <div id="log"></div>

    <script type="module">
      const logEl = document.getElementById('log')
      const coordEl = document.getElementById('coord')
      const seedsEl = document.getElementById('seeds')
      const startBtn = document.getElementById('start')
      const leaseBtn = document.getElementById('lease')

      function log(msg) {
        logEl.textContent += msg + '\n'
        logEl.scrollTop = logEl.scrollHeight
      }

      startBtn.addEventListener('click', async () => {
        try {
          const coord = coordEl.value.trim() || (location.protocol+'//'+location.host)
          const seeds = seedsEl.value.split(/\n+/).map(s => s.trim()).filter(Boolean)
          const body = { plan_version: '1.0.0', seeds }
          log('[POST] ' + coord + '/spider/plans ' + JSON.stringify(body))
          const r = await fetch(coord + '/spider/plans', { method: 'POST', headers: { 'content-type': 'application/json' }, body: JSON.stringify(body) })
          const j = await r.json()
          log('[plan] ' + JSON.stringify(j))
        } catch (e) {
          log('[error] ' + e)
        }
      })

      leaseBtn.addEventListener('click', async () => {
        try {
          const coord = coordEl.value.trim() || (location.protocol+'//'+location.host)
          const u = new URL('/spider/lease', coord)
          u.searchParams.set('worker_id', 'ui')
          u.searchParams.set('n', '5')
          const r = await fetch(u, { method: 'GET' })
          const j = await r.json()
          log('[lease] ' + JSON.stringify(j))
        } catch (e) {
          log('[error] ' + e)
        }
      })
    </script>
  </body>
</html>
