{
    servers {
        protocols h1 h2 h3
        timeouts read_body 60s
    }
}

# Front TLS (internal CA) on configurable port; set FRONT_PORT (default 8443)
:{$FRONT_PORT} {
    tls internal
    encode zstd gzip

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }

    # Reverse proxy to backend (HTTP/1.1 uvicorn) at BACKEND_ADDR, e.g., 127.0.0.1:8811
    reverse_proxy {$BACKEND_ADDR} {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Real-IP {remote_host}
        flush_interval 100ms
    }
}
