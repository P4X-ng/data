(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[9082],{33668:function(t,e,s){"use strict";s.d(e,{Z:function(){return h}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex flex-row overflow-x-auto rtl-space-x-reverse space-x-4"},t._l(t.percentageValues,(function({label:s,divisor:i}){return e("button",{key:s,staticClass:"border font-bold px-2 py-1 rounded-md text-brand-primary text-sm w-14",class:[{"border-brand-primary bg-brand-primary bg-opacity-5":s===t.selected,"border-black border-opacity-20 bg-gray":s!==t.selected},`t-perc-btn t-perc-btn-${s}`],on:{click:function(e){return t.select({label:s,divisor:i})}}},[e("span",1===i?[t._v(t._s(t.$t("general.max")))]:[t._v(t._s(t.localizePercentage(s)))])])})),0)},n=[],a=s(70794),r=s(10359),o=s(37426),l={name:"PercentageButtons",props:{token:{default:void 0,type:Object},value:{default:void 0,type:[a.Z,Number,String]}},data(){return{calculatedAmount:null,percentageValues:[{divisor:4,label:"25"},{divisor:2,label:"50"},{divisor:1,label:"100"}],selected:null}},watch:{value(){this.value!==this.calculatedAmount&&(this.selected=null)}},methods:{calculateAmount(t){const e=Object.assign({},this.token,{balance:new a.Z(this.token.balance).dividedBy(t)});this.calculatedAmount=o.Z.tokenDecimal(e)||(0,a.Z)(0),this.$emit("change",this.calculatedAmount)},localizePercentage:r.Z.localizePercentage,select({label:t,divisor:e}){this.selected=t,this.calculateAmount(e)}}},c=l,d=s(1001),u=(0,d.Z)(c,i,n,!1,null,null,null),h=u.exports},84103:function(t,e,s){"use strict";s.d(e,{Z:function(){return A}});var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"w-full"},[t.value?e("div",{staticClass:"bg-input-bg cursor-pointer flex rounded-full t-asset_selector-show_dialog",on:{click:t.showDialog}},[e("token-icon",{staticClass:"h-8 mx-4 my-5 w-10",attrs:{address:t.address,chain:t.chain}}),e("div",{staticClass:"flex items-center justify-between truncate w-full"},[e("div",{staticClass:"tracking-wider truncate"},[e("div",{staticClass:"font-bold text-lg truncate"},[t._v(t._s(t.name))]),e("div",{staticClass:"flex font-bold items-center text-grey-A text-sm truncate"},[e("span",{staticClass:"mr-2"},[t._v(t._s(t.symbol))]),e("chain-badge",{attrs:{chain:t.chain}})],1)]),e("i",{staticClass:"icon-chevron_down m-4 text-dark-N60 w-6"})])],1):t._e(),e("asset-selector-dialog",{ref:"dialog",attrs:{options:t.options,"still-loading-count":t.stillLoadingCount,value:t.value}})],1)},n=[],a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.showing,expression:"showing"}],staticClass:"bg-background bottom-0 fixed left-0 right-0 top-0 z-30"},[e("div",{staticClass:"flex flex-col h-full"},[e("top-bar",{attrs:{"emit-back":"","test-parent-name":"asset_selector_dialog",title:t.$t("general.selectAssets")},on:{back:t.close}}),e("div",{staticClass:"px-4"},[e("opera-input",{staticClass:"t-token_dialog-query",attrs:{placeholder:t.$t("general.search"),"prepend-icon":"icon-search text-brand-primary text-opacity-40",type:"search",value:t.search},on:{input:t.updateSearch}})],1),e("div",{staticClass:"h-full overflow-y-scroll pb-4 px-4",on:{scroll:t.onScroll}},[t.loading&&t.search?e("div",{staticClass:"flex flex-1 items-center justify-center w-full"},[e("i",{staticClass:"animate-spin icon-spinner text-xl"})]):[t._l(t.tokenList,(function(s,i){return e("div",{key:i},[e("token-item",{staticClass:"my-3",attrs:{address:"contract"in s?s.contract.contract:s.address,chain:s.chain,name:"contract"in s?s.contract.name:s.name,selectable:!1,symbol:"contract"in s?s.contract.symbol:s.symbol,value:s},on:{change:t.itemClicked}})],1)})),e("back-to-top")],t._l(t.stillLoadingCount,(function(t){return e("div",{key:`loading-${t}`,staticClass:"bg-dark-N16 border border-black border-opacity-10 cursor-wait flex items-center justify-between mb-2 mt-3 px-6 py-3 rounded-lg t-token_loading_item",style:{opacity:1/t}},[e("div",{staticClass:"h-10"},[e("lottie-component",{staticClass:"h-10",attrs:{src:"loader_tx.json"}})],1)])}))],2)],1)])},r=[],o=s(72232),l=s(76501),c=s(14957),d=s(8893),u=s(69986),h=s(20144);const m=20;var p=h.ZP.extend({name:"AssetSelectorDialog",components:{BackToTop:o.Z,LottieComponent:l.Z,OperaInput:c.Z,TokenItem:d.Z,TopBar:u.Z},props:{options:{default:void 0,type:Array},stillLoadingCount:{default:0,type:Number},value:{default:void 0,type:Object}},data(){return{callback:null,loading:!1,pageSize:m,search:"",showing:!1}},computed:{tokenList(){const{tokens:t}=this;return this.search?t.filter(this.applyTokenSearchFilter).slice(0,this.pageSize):t.slice(0,this.pageSize)},tokens(){return this.options}},methods:{applyTokenSearchFilter(t){const e="contract"in t?t.contract.name:t.name,s=this.$store.getters.chainNameFriendly(t.chain),i="contract"in t?t.contract.symbol:t.symbol;return e.toLowerCase().includes(this.search.toLowerCase())||i.toLowerCase().includes(this.search.toLowerCase())||s.toLowerCase().includes(this.search.toLowerCase())},close(){!this.value||this.$route.meta?.preselectToken?this.$router.go(-1):this.showing=!1},async itemClicked(t){this.loading=!0,this.callback(t),this.showing=!1,this.loading=!1},onScroll(t){const{target:e}=t,s=e.scrollTop+e.clientHeight>=e.scrollHeight-e.clientHeight;s&&(this.pageSize+m<this.tokens.length?this.pageSize+=m:this.pageSize=this.tokens.length-1)},show(t){this.callback=t,this.showing=!0},updateSearch(t){this.search=t}}}),v=p,g=s(1001),k=(0,g.Z)(v,a,r,!1,null,null,null),f=k.exports,b=s(43130),w=s(92266),y=h.ZP.extend({name:"AssetSelector",components:{AssetSelectorDialog:f,ChainBadge:b.Z,TokenIcon:w.Z},props:{options:{default:void 0,type:Array},stillLoadingCount:{default:0,type:Number},value:{default:void 0,type:Object}},data(){return{dialog:!1}},computed:{address(){return"contract"in this.token?this.token.contract.contract:this.token.address},chain(){return this.token.chain},name(){return"contract"in this.token?this.token.contract.name:this.token.name},preselectToken(){return this.$route.meta?.preselectToken},symbol(){return"contract"in this.token?this.token.contract.symbol:this.token.symbol},token(){return this.value??this.$store.getters.matchingNativeToken("",this.chain)}},mounted(){this.preselectToken&&this.showDialog()},activated(){this.preselectToken&&"SendToken"===this.$route.name&&this.showDialog()},methods:{showDialog(){this.$refs.dialog.show((t=>{const{meta:e}=this.$route;e&&e.preselectToken&&(e.preselectToken=!1),this.$emit("input",t)}))}}}),x=y,_=(0,g.Z)(x,i,n,!1,null,null,null),A=_.exports},33752:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return x}});var i=function(){var t=this,e=t._self._c;return t.token?e("div",[e("top-bar",{attrs:{"test-parent-name":"send_view",title:t.$t("general.send")}}),e("div",{staticClass:"px-14 py-4"},[e("div",{staticClass:"flex font-bold mb-4 relative"},[t._v(" "+t._s(t.$t("general.recipient"))+" "),e("img",{staticClass:"h-4 ml-2.5 mt-1 w-4",attrs:{src:s(92769)},on:{mouseout:t.hideAddressResolversPopover,mouseover:t.showAddressResolversPopover}}),e("simple-popover",{ref:"addressResolversPopover",staticClass:"absolute left-12 shadow-2xl top-8 w-10/12 z-10",attrs:{"caret-horizontal-position":"left-5"}},[e("div",[e("p",{staticClass:"font-semibold mb-6 text-dark-N77"},[t._v(" "+t._s(t.$t("views.sendView.domainNamesSupported"))+" ")]),t._l(t.addressResolvers,(function([i,n]){return e("div",{key:i,staticClass:"flex items-center mt-4 space-x-4"},[e("img",{attrs:{alt:"",src:s(61986)(`./${i}.svg`)}}),e("p",{staticClass:"font-medium text-left"},[t._v(t._s(n))])])}))],2)])],1),e("opera-input",{staticClass:"t-send_view-recipient",attrs:{error:!t.validRecipient&&t.amountInitialized?t.$t("errors.generic.invalidRecipient"):"",icon:t.recipientInputIcon,"img-url":t.addressResolver?s(61986)(`./${t.addressResolver}.svg`):"",loading:t.resolvingAddress||t.auditingAddress,placeholder:t.$t("general.enterAddressOrDomain"),"test-error-class":"t-send_view-invalid_recipient",warning:t.isAddressMalicious?t.$t("warnings.maliciousAddressCheck.warning"):""},nativeOn:{input:function(e){return t.resolveAddress(500)}},model:{value:t.recipient,callback:function(e){t.recipient=e},expression:"recipient"}}),e("p",{directives:[{name:"show",rawName:"v-show",value:!(!t.validRecipient&&t.amountInitialized)&&!t.isAddressMalicious,expression:"!(!validRecipient && amountInitialized) && !isAddressMalicious"}],staticClass:"-mt-4 text-dark-N77 text-xs"},[t._v(" "+t._s(t.resolvedAddress)+" ")]),e("br"),e("div",{staticClass:"font-bold mb-4"},[t._v(t._s(t.$t("general.asset")))]),e("asset-selector",{staticClass:"mb-2 t-send_view-asset",attrs:{options:t.sendableTokens},model:{value:t.token,callback:function(e){t.token=e},expression:"token"}}),e("div",{staticClass:"t-send_view-token_balance text-dark-N77 text-xs"},[t._v(" "+t._s(t.$t("general.balance"))+": "+t._s(t.fullBalance)+" ")]),e("br"),e("div",{staticClass:"flex items-center justify-between mb-4"},[e("span",{staticClass:"font-bold"},[t._v(t._s(t.$t("general.amount")))]),e("percentage-buttons",{staticClass:"t-send_view-percentage",attrs:{token:t.token,value:t.amount},on:{change:t.assignNewAmount}})],1),e("opera-input",{staticClass:"t-send_view-amount",attrs:{amount:"",error:!t.validAmount&&t.amountInitialized?t.$t("errors.generic.invalidAmount"):"",icon:!t.validAmount&&t.amountInitialized?"icon-error":"",placeholder:t.$t("general.amountToSend"),"test-error-class":"t-send_view-invalid_amount"},model:{value:t.amount,callback:function(e){t.amount=e},expression:"amount"}}),e("transition",{attrs:{name:"fade"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.errorMessage,expression:"errorMessage"}],staticClass:"my-4 text-spectrum-red"},[t._v(" "+t._s(t.errorMessage)+" ")])]),e("div",{staticClass:"bottom-group"},[e("primary-button",{staticClass:"mx-11 t-send_view-next w-full",attrs:{disabled:t.loading||!t.simpleValid||t.isAmountTooSmall,loading:t.loading,title:t.$t("general.next")},on:{click:t.next}})],1)],1)],1):t._e()},n=[],a=(s(57658),s(47812)),r=s(79317),o=s(46686),l=s(84103),c=s(70794),d=s(14957),u=s(33668),h=s(25778),m=s(18135),p=s(69790),v=s(69986),g=s(10359),k=s(37426),f={name:"SendView",components:{AssetSelector:l.Z,OperaInput:d.Z,PercentageButtons:u.Z,PrimaryButton:h.Z,SimplePopover:m.Z,TopBar:v.Z},beforeRouteEnter(t,e,s){"SendConfirm"===e.name&&"SendToken"===t.name?s():s((t=>{t.recipient="",t.amount=null,t.token=t.getToken()}))},data(){return{amount:null,error:null,loading:!1,message:"",recipient:"",timer:null,token:null,transaction:null}},computed:{addressResolver(){return this.$store.getters.addressResolver},addressResolvers(){return this.$store.getters.addressResolvers},amountInitialized(){return null!==this.amount},amountWithoutDecimals(){return k.Z.withoutDecimals(this.amount,this.token.contract.decimals)},auditingAddress(){return this.$store.getters.isLoading("addressAudit")},chain(){return this.token.chain},errorMessage(){return this.isAmountTooSmall?this.$t("errors.amountTooSmall"):this.getErrorMessage()},fullBalance(){return this.$store.getters.getFullTokenBalance(this.token.contract.contract,this.token,this.chain,r.oZ.VISIBLE)},isAddressMalicious(){return this.$store.getters.isAddressMalicious},isAmountTooSmall(){if(!this.validAmount)return;const t=1e-5;return((0,o.ij)(this.token.chain)||(0,o.wS)(this.token.chain))&&new c.Z(this.amount).isLessThan(t)},maxAmount(){return k.Z.withDecimals(this.token?.balance||0,this.token.contract?.decimals||0)},nativeVisibleTokens(){return this.$store.getters.nativeTokens(r.oZ.VISIBLE)},recipientAddress(){return this.resolvedAddress||this.recipient},recipientInputIcon(){return!this.validRecipient&&this.amountInitialized?"icon-error":this.isAddressMalicious?"icon-warning":this.addressResolver?"":this.validRecipient?"icon-check_selected":"icon-contacts"},resolvedAddress(){return this.$store.getters.resolvedAddress},resolvingAddress(){return this.$store.getters.isLoading("addressResolver")},sendableTokens(){return this.$store.getters.ownedTokens(r.oZ.VISIBLE).filter((t=>(0,c.Z)(t.balance).isGreaterThan(0)))},simpleValid(){return this.validRecipient&&this.validAmount},valid(){return this.validRecipient&&this.validAmount&&this.transaction},validAmount(){return!!this.token&&((0,c.Z)(this.amount).isGreaterThan(0)&&(0,c.Z)(this.amount).isLessThanOrEqualTo(this.maxAmount))},validRecipient(){return this.$store.getters.isAddressValid(this.recipientAddress)&&!this.$store.getters.txError["invalidRecipient"]}},watch:{amount(){this.error=null},resolvedAddress(t){t&&this.$store.dispatch("auditAddress",{address:this.recipientAddress,chain:this.chain})},token(){this.amount=null,this.resolveAddress(100)}},beforeDestroy(){this.$store.dispatch("clearTxError"),clearTimeout(this.timer)},mounted(){p.Z.sendStatsEvent(p.Z.types.IMPRESSION,"wt_send_entered"),this.$store.commit("SET_TX_CHAIN",this.chain)},methods:{assignNewAmount(t){this.amount=t},async buildTransactionPayload(){const t=g.Z.removeExponential(this.amountWithoutDecimals).toString(),{contract:e}=this.token,s=(0,c.Z)(this.amount).isEqualTo(this.maxAmount),i={amount:t,from:this.$store.getters.accountsByCoinType[this.chain.coinType],sendMaxAmount:s,to:this.recipientAddress,token:{address:e.contract,chain:this.chain,decimals:e.decimals,symbol:e.symbol,type:this.$store.getters.getTokenType(e.type)}};return i.token.address===a.L1&&delete i.token.address,i},async createTransaction(){if(!this.validRecipient||!this.validAmount)return null;try{const t=await this.buildTransactionPayload(),e=await this.$wallet.createTransaction(t);e.token&&!e.token.decimals&&(e.token.decimals=this.token.contract.decimals),this.transaction=Object.assign(e,{amount:t.amount,from:t.from,to:t.to})}catch(t){this.transaction=null,this.error=t.message||t}return this.transaction},getErrorMessage(){if(!this.error)return"";const{error:t}=this,e=[{message:this.$t("errors.insufficientFunds"),raw:"insufficient funds"},{message:this.$t("errors.cannotEstimateGas"),raw:"cannot estimate gas"},{message:this.$t("errors.nameResolutionFailed"),raw:"ENS: Lookup"},{message:this.$t("errors.minimumSendAmountError",{amount:t.match(/\d+\.?\d* [A-Z]+$/g)?.[0]}),raw:"Minimum amount to send is"}],s=e.find((e=>t.includes(e.raw)))?.message;return s??("string"===typeof t&&t)??this.$t("errors.generic.unknownError")},getToken(){const{token:t}=this.$route.params,e=this.$store.getters.visibleNetworks[0].nativeCurrency;return t??e},hideAddressResolversPopover(){this.$refs.addressResolversPopover.hide()},async next(){if(!this.simpleValid||this.loading)return;p.Z.sendStatsEvent(p.Z.types.CLICK,"wt_send_next_suc",{network:this.$store.getters.getNetworkName(this.chain)}),this.loading=!0,this.$progress.show();const t=await this.createTransaction();this.$progress.hide(),t&&!this.error&&this.$router.push({name:"SendConfirm",params:{token:this.token,transaction:this.transaction}}),this.loading=!1},resolveAddress(t){!this.resolvingAddress&&this.timer&&(this.$store.dispatch("clearResolvedAddressData"),this.$store.dispatch("clearAddressAuditData")),clearTimeout(this.timer),this.timer=setTimeout((async()=>{const t={address:this.recipientAddress,chain:this.chain};await this.$store.dispatch("resolveAddress",t),await this.$store.dispatch("auditAddress",t)}),t)},showAddressResolversPopover(){this.$refs.addressResolversPopover.show()}}},b=f,w=s(1001),y=(0,w.Z)(b,i,n,!1,null,"8a240450",null),x=y.exports},61986:function(t,e,s){var i={"./1inch.svg":35815,"./ens.svg":35332,"./fio.svg":27200,"./goplus.svg":9293,"./moonpay.svg":82820,"./pancakeswap.svg":66670,"./ud.svg":68237,"./yat.svg":15418};function n(t){var e=a(t);return s(e)}function a(t){if(!s.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}n.keys=function(){return Object.keys(i)},n.resolve=a,t.exports=n,n.id=61986},35332:function(t,e,s){"use strict";t.exports=s.p+"img/ens.14260065.svg"},27200:function(t,e,s){"use strict";t.exports=s.p+"img/fio.a9a38124.svg"},82820:function(t,e,s){"use strict";t.exports=s.p+"img/moonpay.8cd24a6f.svg"},68237:function(t,e,s){"use strict";t.exports=s.p+"img/ud.65fd7dae.svg"},15418:function(t,e,s){"use strict";t.exports=s.p+"img/yat.4ca801f0.svg"},92769:function(t,e,s){"use strict";t.exports=s.p+"img/help.5bb18606.svg"}}]);