"use strict";(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[7465],{92266:function(t,e,s){s.d(e,{Z:function(){return _}});var r=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"bg-contain bg-no-repeat relative rounded-full",class:[{[t.bgIconClass]:!t.icon&&!t.iconUri||t.error}]},[t.showNonVerifiedStatus&&!t.verified?e("img",{staticClass:"absolute",class:[t.nonVerifiedTokenIconClasses],attrs:{src:s(37652)},on:{mouseout:function(e){return t.$emit("hideUnverifiedTokenPopover")},mouseover:function(e){return t.$emit("showUnverifiedTokenPopover",e)}}}):t._e(),t.displayChainBadge?e("img",{staticClass:"-bottom-1 -right-1 absolute border-2 border-dark-N16 h-5 rounded-full w-5",attrs:{src:t.chainLogo},on:{mouseover:t.showChainTokenPopover}}):t._e(),t.displayChainBadge?e("chain-token-popover",{ref:"chainTokenPopover",attrs:{chain:t.chain,"popover-position":"left-[86px]"}}):t._e(),t.checked?e("div",{staticClass:"-ml-[1.5px] -mt-0.5 absolute bg-black bg-opacity-80 border-2 border-brand-primary h-9 rounded-full w-9"},[e("img",{staticClass:"h-4 mt-2 mx-auto w-4",attrs:{src:s(65035)}})]):t._e(),t.error?t._e():e("img",{staticClass:"h-full object-contain rounded-full w-full",class:{"bg-white":t.loaded&&!t.error},attrs:{src:t.icon||t.iconUri},on:{error:function(e){t.error=!0},load:function(e){t.loaded=!0}}})],1)},i=[],o=s(79317),n=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("Transition",{attrs:{name:"slide"}},[e("simple-popover",{ref:"popover",staticClass:"fixed t-chain_token_popover text-sm w-0 z-10",class:[t.popoverPosition],attrs:{"background-class":"bg-dark-N04",caret:!1,"caret-horizontal-position":"",padding:"p-0"}},[e("chain-badge",{staticClass:"h-6 text-xs w-max",attrs:{chain:t.chain}})],1)],1)},a=[],c=s(43130),l=s(18135),d=s(20144),u=d.ZP.extend({name:"ChainTokenPopover",components:{ChainBadge:c.Z,SimplePopover:l.Z},props:{chain:{default:void 0,type:Object},popoverPosition:{required:!0,type:String}},computed:{popover(){return this.$refs.popover}},methods:{show(t){this.popover.show(),this.$nextTick((()=>{const e=this.popover.$el,s=e.offsetHeight+t.offsetY;e.style.top=t.pageY-s+20+"px"}))}}}),h=u,p=s(1001),f=(0,p.Z)(h,n,a,!1,null,"5b9d2111",null),m=f.exports,v=s(13692),w=s(13212),g=s(37426),x=d.ZP.extend({name:"TokenIcon",components:{ChainTokenPopover:m},props:{address:{default:"",type:String},chain:{default:void 0,type:Object},checked:{default:!1,type:Boolean},iconUri:{default:"",type:String},nonVerifiedTokenIconClasses:{default:"-left-2.5 h-5 top-2 w-5",type:String},showChainInfo:{default:!1,type:Boolean},type:{default:"",type:String}},data(){return{error:!1,loaded:!1,token:void 0}},computed:{bgIconClass(){let t="bg-generic-token";return this.showNonVerifiedStatus&&!this.verified&&(t="bg-generic-token-unverified"),`${t} bg-dark-N16`},chainLogo(){return this.chain?(0,v.Z)(this.chain).icon():""},chainTokenPopover(){return this.$refs.chainTokenPopover},displayChainBadge(){return!!this.token&&(this.showChainInfo&&!g.Z.isNativeToken(this.token))},icon(){const t=w["default"].isNftType(this.type);return this.error||!this.chain||t?"":(0,v.Z)(this.chain).tokenIconUrl(this.address)},showNonVerifiedStatus(){const t=["Overview","WatchListSettings"],e=t.includes(this.$route.name),s="undefined"!==typeof this.token;return!e&&s},verified(){return!this.showNonVerifiedStatus||g.Z.isTokenVerified(this.token)}},watch:{address(){this.error=!1,this.loaded=!1}},mounted(){this.address&&this.chain&&(this.token=this.$store.getters.getTokenViaSerializedKey(this.address,this.chain,o.oZ.ALL))},methods:{showChainTokenPopover(t){this.chainTokenPopover.show(t)}}}),k=x,C=(0,p.Z)(k,r,i,!1,null,"8c61503c",null),_=C.exports},43130:function(t,e,s){s.d(e,{Z:function(){return d}});var r=function(){var t=this,e=t._self._c;return t.chainNameFriendly?e("div",{staticClass:"flex items-center justify-center px-2 py-0.5 rounded-full space-x-1 t-chain-badge text-center text-dark-N77 truncate",class:[t.backgroundColor]},[t.chainLogo?e("img",{staticClass:"border-2 border-dark-N16 h-5 object-contain rounded-full w-5",attrs:{alt:"",src:t.chainLogo}}):t._e(),e("div",{staticClass:"t-chain-badge-name"},[t._v(t._s(t.chainNameFriendly))])]):t._e()},i=[],o=s(13692),n={name:"ChainBadge",props:{backgroundColor:{default:"bg-dark-N16",type:String},chain:{default:void 0,type:Object}},computed:{chainLogo(){if(this.chain)return(0,o.Z)(this.chain).icon()},chainNameFriendly(){if(this.chain)return this.$store.getters.chainNameFriendly(this.chain)}}},a=n,c=s(1001),l=(0,c.Z)(a,r,i,!1,null,null,null),d=l.exports},67465:function(t,e,s){s.r(e),s.d(e,{default:function(){return x}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex flex-col h-full"},[e("top-bar",{attrs:{"test-parent-name":"swap_confirm",title:t.$t("general.confirm")}}),e("div",{staticClass:"flex flex-col flex-grow p-4"},[e("div",[e("div",{staticClass:"bg-neutral-09 p-4 rounded-tl-xl rounded-tr-xl"},[e("div",{staticClass:"flex flex-col items-center justify-center"},[e("div",{staticClass:"flex flex-row items-center justify-center"},[e("div",{staticClass:"flex flex-col items-end relative shrink-0 w-1/2"},[e("token-icon",{staticClass:"-right-3 absolute h-14 my-2 w-14",attrs:{address:t.fromTokenAddress,chain:t.chain}}),e("div",{staticClass:"flex justify-end text-2xl text-dark-N77 text-end truncate w-full"},[e("div",{staticClass:"max-w-[150px] pr-2 truncate",attrs:{title:t.formatNumber(t.fromTokenAmount)}},[t._v(" "+t._s(t.formatNumber(t.fromTokenAmount))+" ")]),e("div",{staticClass:"max-w-[85px] min-w-[42px] truncate",attrs:{title:t.currentSwap.fromToken.symbol}},[t._v(" "+t._s(t.currentSwap.fromToken.symbol)+" ")])]),e("div",{staticClass:"h-6 text-dark-N77-op50"},[t.fromTokenFiatAmount>0?e("span",[t._v(t._s("~ "+t.localizeCurrency(t.fromTokenFiatAmount)))]):t._e()])],1),e("img",{staticClass:"mb-4 text-brand-primary z-10",attrs:{src:s(96352)}}),e("div",{staticClass:"flex flex-col items-start relative shrink-0 w-1/2"},[e("token-icon",{staticClass:"-left-3 absolute h-14 my-2 w-14",attrs:{address:t.toTokenAddress,chain:t.chain}}),t.loading?e("lottie-component",{staticClass:"my-2.5 w-2/3",attrs:{src:"loader_tx.json"}}):e("div",{staticClass:"flex justify-start text-2xl text-start truncate w-full"},[e("div",{staticClass:"max-w-[120px] pr-2 truncate",attrs:{title:t.formatNumber(t.toTokenAmount)}},[t._v(" "+t._s(t.formatNumber(t.toTokenAmount))+" ")]),e("div",{staticClass:"max-w-[85px] min-w-[42px] truncate",attrs:{title:t.currentSwap.toToken.symbol}},[t._v(" "+t._s(t.currentSwap.toToken.symbol)+" ")])]),t.loading?e("lottie-component",{staticClass:"h-6 w-1/3",attrs:{src:"loader_tx.json"}}):e("div",{staticClass:"h-6 text-[#ffffff80]"},[t.toTokenFiatAmount>0?e("span",[t._v(t._s("~ "+t.localizeCurrency(t.toTokenFiatAmount)))]):t._e()])],1)]),e("div",{staticClass:"border-b border-dashed border-neutral-05 my-4 w-full"}),e("div",{staticClass:"flex mb-4 w-full"},[t._m(0),e("div",{staticClass:"ms-4 w-full"},[e("div",{staticClass:"text-dark-N77 text-sm"},[t._v(t._s(t.$t("general.rate")))]),t.loading?e("lottie-component",{staticClass:"my-1 w-2/3",attrs:{src:"loader_tx.json"}}):e("div",{staticClass:"font-bold mb-1"},[t._v(" "+t._s(t.conversion)+" ")])],1)]),e("div",{staticClass:"flex mb-4 w-full"},[t._m(1),e("div",{staticClass:"ms-4 w-full"},[e("div",{staticClass:"text-dark-N77 text-sm"},[t._v(t._s(t.$t("general.maxSlippage")))]),t.loading?e("lottie-component",{staticClass:"my-1 w-2/3",attrs:{src:"loader_tx.json"}}):e("div",{staticClass:"font-bold mb-1"},[t._v(t._s(t.localizePercentage(t.slippageMax)))])],1)]),e("div",{staticClass:"flex mb-4 w-full"},[t._m(2),t.tx&&null!==t.fee?e("div",{staticClass:"ms-4 w-full"},[e("div",{staticClass:"text-dark-N77 text-sm"},[t._v(t._s(t.$t("general.transactionFee")))]),t.loading?e("lottie-component",{staticClass:"my-1 w-2/3",attrs:{src:"loader_tx.json"}}):e("div",{staticClass:"font-bold mb-1",class:[{"text-spectrum-red":t.insufficientFunds}]},[t._v(" "+t._s(t.transactionFee)+" ")])],1):t._e()]),t.isFeeZero?e("div",{staticClass:"flex items-center w-full"},[t._m(3),e("div",{staticClass:"ms-4 mt-2.5 text-sm text-spectrum-red w-full"},[t._v(" "+t._s(t.$t("errors.cannotEstimateGas"))+" ")])]):t._e()])]),t._m(4),e("div",{staticClass:"bg-neutral-09 flex justify-between p-4 px-8 rounded-bl-xl rounded-br-xl"},[e("div",{staticClass:"font-semibold text-2xl"},[t._v(t._s(t.$t("general.total")))]),e("div",{staticClass:"font-semibold text-2xl text-brand-primary"},[e("span",[t._v(t._s(t.localizeCurrency(t.totalFiatAmount)))])])]),!t.insufficientFunds&&t.error?e("div",{staticClass:"bg-spectrum-red/[.15] my-4 rounded-lg text-red text-sm w-full"},[e("div",{staticClass:"flex items-center pr-2 py-4 text-left"},[e("img",{staticClass:"h-6 mx-5 w-6",attrs:{src:s(571)}}),e("div",[e("p",[t._v(" "+t._s(t.$t("errors.couldntCalculateNetworkError"))+" ")]),e("p",{staticClass:"cursor-pointer text-accent underline",on:{click:t.refresh}},[t._v(" "+t._s(t.$t("general.refresh"))+" ")])])])]):t.error?e("div",{staticClass:"flex justify-center my-4 text-center text-sm text-spectrum-red"},[e("img",{staticClass:"mx-2",attrs:{alt:"",src:s(98498)}}),e("span",[t._v(t._s(t.error))])]):t._e()]),e("div",{staticClass:"flex-grow"}),e("div",{staticClass:"my-4"},[e("div",{staticClass:"flex flex-col items-center leading-3 mx-13 text-2xs text-center"},[e("p",{class:[{"mb-2":"SaviSwap"===t.swapProvider}]},[t._v(" "+t._s(t.$t("general.poweredBy",{serviceProvider:t.swapProviderLogo?"":t.swapProvider}))+" ")]),"SaviSwap"!==t.swapProvider?e("img",{staticClass:"h-6 my-1",attrs:{alt:"",src:t.swapProviderLogo}}):t._e(),e("i18n",{attrs:{path:t.swapProviderTermsLink?"legal.swapProvider":"legal.swapProviderNoTerms",tag:"p"},scopedSlots:t._u([{key:"swapProvider",fn:function(){return[e("span",[t._v(t._s(t.swapProvider))])]},proxy:!0},t.swapProviderTermsLink?{key:"swapProviderTerms",fn:function(){return[e("a",{staticClass:"t-swap_view-tos text-brand-primary",on:{click:function(e){return t.$platform.createNewTab({url:t.swapProviderTermsLink})}}},[t._v(" "+t._s(t.$t("legal.swapProviderTerms"))+" ")])]},proxy:!0}:null],null,!0)})],1),e("primary-button",{staticClass:"mt-4 t-swap_confirm-swap w-full",attrs:{disabled:t.loading||!!t.error,loading:t.loading,title:t.$t("general.swap")},on:{click:t.confirmTransaction}},[e("lottie-component",{staticClass:"absolute",attrs:{src:"loader_button.json"}})],1)],1)])],1)},i=[function(){var t=this,e=t._self._c;return e("span",{staticClass:"icon-wrapper"},[e("i",{staticClass:"icon-coupon info-icon"})])},function(){var t=this,e=t._self._c;return e("span",{staticClass:"icon-wrapper"},[e("i",{staticClass:"icon-slippage info-icon"})])},function(){var t=this,e=t._self._c;return e("span",{staticClass:"icon-wrapper"},[e("i",{staticClass:"icon-currency info-icon"})])},function(){var t=this,e=t._self._c;return e("span",{staticClass:"icon-wrapper"},[e("i",{staticClass:"icon-error text-spectrum-red"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"-my-2 bg-neutral-09 flex items-center justify-between"},[e("div",{staticClass:"half-circle-left z-10"}),e("div",{staticClass:"border-b border-dashed border-neutral-05 w-full"}),e("div",{staticClass:"half-circle-right z-10"})])}],o=s(17017),n=s(70794),a=s(76501),c=s(25778),l=s(69790),d=s(92266),u=s(69986),h=s(10359),p=s(37426),f=s(25108),m={name:"SwapConfirm",components:{LottieComponent:a.Z,PrimaryButton:c.Z,TokenIcon:d.Z,TopBar:u.Z},props:{chain:{default:void 0,type:Object},slippageMax:{default:1,type:Number},swap:{default:void 0,type:Object}},data(){return{error:null,fee:null,loading:!1,success:!1,tx:null}},computed:{conversion(){if(!this.currentSwap)return null;const t=this.currentSwap.fromToken.symbol,e=this.toTokenAmount.dividedBy(this.fromTokenAmount),s=this.currentSwap.toToken.symbol;return`1 ${t} ≈ ${h.Z.formatNumber(e)} ${s}`},currentSwap(){return this.swap.length?this.swap:this.$store.getters.currentSwap},feeFiat(){if(!this.fee)return;const t=this.$store.getters.matchingNativeToken("",this.chain),e=this.getPriceForToken(t);return this.formatNumber(this.fee).multipliedBy(new n.Z(e))},feeSymbol(){const t=this.$store.getters.matchingNativeToken("",this.chain);return t?t.contract.symbol.toUpperCase():""},fromTokenAddress(){return this.currentSwap.fromToken?.address},fromTokenAmount(){return p.Z.withDecimals(this.currentSwap.fromTokenAmount,this.currentSwap.fromToken.decimals)},fromTokenFiatAmount(){const t=this.getPriceForToken(this.currentSwap.fromToken);return this.fromTokenAmount.multipliedBy(t)},insufficientFunds(){return this.$store.getters.txError.insufficientFunds},isFeeZero(){if(null!==this.fee)return this.fee.isEqualTo(0)},swapProvider(){return this.$store.getters.aggregatorName},swapProviderLogo(){return this.$store.getters.aggregatorLogo},swapProviderTermsLink(){return this.$store.getters.aggregatorTermsLink},toTokenAddress(){return this.currentSwap.toToken?.address},toTokenAmount(){return p.Z.withDecimals(this.currentSwap.toTokenAmount,this.currentSwap.toToken.decimals)},toTokenFiatAmount(){const t=this.getPriceForToken(this.currentSwap.toToken);return this.toTokenAmount.multipliedBy(t)},totalFiatAmount(){return this.toTokenFiatAmount.plus(this.feeFiat)},transactionFee(){if(!this.tx)return;const[t,e]=[this.formatNumber(this.fee),this.localizeCurrency(this.feeFiat)];return`~ ${t} ${this.feeSymbol} (${e})`},txNetwork(){return this.$store.getters.getTransactionNetwork(this.chain)}},watch:{insufficientFunds(t){t&&(this.error=this.$t("errors.generic.insufficientFunds"))}},async mounted(){await this.setupTx(),this.setSwapTxFee()},beforeDestroy(){this.$store.dispatch("clearTxError")},methods:{async confirmTransaction(){if(this.error)return;let t;l.Z.sendStatsEvent(l.Z.types.CLICK,"wt_swap_confirm_next"),this.loading=!0;try{t=await this.$wallet.confirmTransaction(this.tx.txId),this.success=!0,this.sendDetailedSwapTxStats(),this.$router.replace({name:"TransactionComplete",params:{token:this.currentSwap.fromToken,txHash:t}})}catch(e){this.$store.getters.authAborted?l.Z.sendStatsEvent(l.Z.types.CLICK,"wt_swap_pwd_can"):(this.error=this.getErrorMessage(e),this.$errorReporter.reportError(e),l.Z.sendStatsEvent(l.Z.types.CLICK,"wt_swap_pwd_fail"))}finally{if(this.loading=!1,this.success){const{currentSwap:e}=this,s={chain:e.fromToken.chain,contract:e.fromToken.address,from:e.tx.from,hash:t,time:Date.now(),to:e.tx.to,type:e.fromToken.type,value:this.swap.fromTokenAmount};this.$store.dispatch("addPendingTransaction",s)}}},formatNumber:h.Z.formatNumber,getErrorMessage(t){f.error(t);const e=t.toString()?.toLowerCase(),s=[{message:this.$t("errors.insufficientFunds"),raw:"insufficient funds"}],r=s.find((t=>e.includes(t.raw)))?.message;return r??this.$t("errors.generic.unknownError")},getPriceForToken(t){return t?this.$store.getters.getPriceForToken(t):0},isTransactionFeeCovered(t){const{symbol:e}=this.currentSwap.fromToken,s={amount:this.fromTokenAmount,chain:this.chain,fee:t,symbol:e};return this.$store.getters.isTransactionFeeCovered(s)},localizeCurrency:h.Z.localizeCurrency,localizePercentage:h.Z.localizePercentage,async refresh(){this.error=null,await this.setupTx(),this.setSwapTxFee()},sendDetailedSwapTxStats(){l.Z.sendStatsEvent(l.Z.types.CLICK,"wt_swap_pwd_suc",{fromAmount:this.fromTokenAmount.toString(),fromCoin:this.currentSwap.fromToken.symbol,fromNetwork:this.txNetwork.name,toAmount:this.toTokenAmount.toString(),toCoin:this.currentSwap.toToken.symbol,toNetwork:this.txNetwork.name,volumeUSD:new n.Z(this.fromTokenAmount).multipliedBy(this.$store.getters.getPriceForToken(this.currentSwap.fromToken)).toString()})},setSwapTxFee(){const t=this.tx.token;this.fee=p.Z.withDecimals(t.amount,t.decimals),this.isTransactionFeeCovered(this.fee)||this.$store.dispatch("setTxError","insufficientFunds")},async setupTx(){this.loading=!0;try{const t=this.swap,e=await(0,o.u1)(t);this.tx=await this.$wallet.createSwapTransaction(e)}catch(t){this.error=this.getErrorMessage(t),this.$errorReporter.reportError(t)}this.loading=!1}}},v=m,w=s(1001),g=(0,w.Z)(v,r,i,!1,null,"6ecb8224",null),x=g.exports},571:function(t,e,s){t.exports=s.p+"img/empty_error.6fa940d6.svg"},65035:function(t,e,s){t.exports=s.p+"img/check_selected.1169a7e5.svg"},96352:function(t,e,s){t.exports=s.p+"img/swap_to.02a4598e.svg"},37652:function(t,e,s){t.exports=s.p+"img/unverified.3e563384.svg"}}]);